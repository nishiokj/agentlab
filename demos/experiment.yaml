version: '0.3'
experiment:
  id: swebench_mini_harness_eval
  name: SWE-bench Mini Harness Eval
  workload_type: agent_harness
  description: Small real issue set for testing harness metrics and artifacts.
  owner: demos

dataset:
  suite_id: swebench_mini
  provider: local_jsonl
  path: ./swebench_mini_tasks.jsonl
  schema_version: task_jsonl_v1
  split_id: eval
  limit: 4

design:
  sanitization_profile: hermetic_functional_v2
  comparison: paired
  replications: 1
  random_seed: 42
  shuffle_tasks: true
  max_concurrency: 1

metrics:
  - id: duration_ms
    source: runner
    weight: 0
    primary: false
  - id: tokens_in
    source: events
    event_type: model_call_end
    event_field: usage.tokens_in
    aggregate: sum
    weight: 0
    primary: false
  - id: tokens_out
    source: events
    event_type: model_call_end
    event_field: usage.tokens_out
    aggregate: sum
    weight: 0
    primary: false
  - id: turn_count
    source: events
    event_type: model_call_end
    aggregate: count
    weight: 0
    primary: false
  - id: difficulty_match
    source: output
    json_pointer: /metrics/difficulty_match
    direction: maximize
    weight: 1
    primary: true
  - id: keyword_hits
    source: output
    json_pointer: /metrics/keyword_hits
    weight: 0
    primary: false
  - id: response_chars
    source: output
    json_pointer: /metrics/response_chars
    weight: 0
    primary: false
  - id: diff_lines
    source: artifacts
    artifact_measure: diff_lines
    direction: minimize
    weight: 0
    primary: false
  - id: json_artifact_files
    source: artifacts
    artifact_measure: file_count
    artifact_glob: artifacts/**/*.json
    weight: 0
    primary: false

artifacts:
  collect:
    - artifacts/**/*.json
    - artifacts/**/*.txt
  diff: true
  base_dir: .

baseline:
  variant_id: control
  bindings:
    difficulty_threshold: 5
    difficulty_bias: 0

variant_plan:
  - variant_id: treatment
    bindings:
      difficulty_threshold: 2
      difficulty_bias: 0

runtime:
  harness:
    mode: cli
    command:
      - node
      - ./agentlab_demo_harness.js
    integration_level: cli_events
    input_path: /out/trial_input.json
    output_path: /out/trial_output.json
    events:
      path: /out/harness_events.jsonl
    control_plane:
      mode: file
      path: /state/lab_control.json
  sandbox:
    mode: local
  network:
    mode: none
    allowed_hosts: []

validity:
  fail_on_state_leak: true
  fail_on_profile_invariant_violation: true
