{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://agent-lab.local/schemas/trial_input_v1.json",
  "title": "Trial Input v1",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "ids", "task", "bindings", "runtime", "design"],
  "properties": {
    "schema_version": { "const": "trial_input_v1" },
    "ids": {
      "type": "object",
      "additionalProperties": false,
      "required": ["run_id", "trial_id", "variant_id", "task_id", "repl_idx"],
      "properties": {
        "run_id": { "type": "string", "minLength": 1 },
        "trial_id": { "type": "string", "minLength": 1 },
        "variant_id": { "type": "string", "minLength": 1 },
        "task_id": { "type": "string", "minLength": 1 },
        "repl_idx": { "type": "integer", "minimum": 0 }
      }
    },
    "task": {
      "type": "object",
      "additionalProperties": true,
      "description": "Benchmark task payload. Schema is benchmark-specific."
    },
    "task_schema": { "type": "string" },
    "workload": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["agent_harness", "trainer", "custom"]
        }
      }
    },
    "bindings": {
      "type": "object",
      "additionalProperties": true,
      "description": "Variant bindings/primitives; interpreted by the harness."
    },
    "design": {
      "type": "object",
      "additionalProperties": false,
      "required": ["sanitization_profile", "integration_level"],
      "properties": {
        "sanitization_profile": {
          "type": "string",
          "enum": ["replay_strict", "hermetic_functional", "perf_benchmark"]
        },
        "integration_level": {
          "type": "string",
          "enum": ["cli_basic", "cli_events", "otel", "sdk_control", "sdk_full"]
        }
      }
    },
    "runtime": {
      "type": "object",
      "additionalProperties": false,
      "required": ["paths", "network", "control_plane"],
      "properties": {
        "paths": {
          "type": "object",
          "additionalProperties": false,
          "required": ["workspace", "state", "dataset", "out", "tmp"],
          "properties": {
            "workspace": { "type": "string" },
            "state": { "type": "string" },
            "cache": { "type": "string" },
            "dataset": { "type": "string" },
            "out": { "type": "string" },
            "tmp": { "type": "string" }
          }
        },
        "network": {
          "type": "object",
          "additionalProperties": false,
          "required": ["mode_requested"],
          "properties": {
            "mode_requested": {
              "type": "string",
              "enum": ["none", "full", "allowlist_enforced"]
            },
            "allowed_hosts": {
              "type": "array",
              "items": { "type": "string", "minLength": 1 }
            }
          }
        },
        "control_plane": {
          "type": "object",
          "additionalProperties": false,
          "required": ["mode", "path"],
          "properties": {
            "mode": { "type": "string", "enum": ["file", "uds"] },
            "path": { "type": "string", "minLength": 1 }
          }
        },
        "budgets": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "max_steps": { "type": "integer", "minimum": 0 },
            "max_total_tokens": { "type": "integer", "minimum": 0 },
            "max_tool_calls": { "type": "integer", "minimum": 0 }
          }
        },
        "timeouts": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "trial_seconds": { "type": "integer", "minimum": 1 },
            "tool_seconds": { "type": "integer", "minimum": 1 }
          }
        }
      }
    },
    "ext": { "type": "object", "additionalProperties": true }
  }
}
